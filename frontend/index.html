<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Stress Analyzer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .main-card { max-width: 800px; margin: 50px auto; border: none; shadow: 0 4px 6px rgba(0,0,0,0.1); border-radius: 12px; }
        .result-box { display: none; margin-top: 20px; transition: all 0.3s ease; }
        .crisis-panel { display: none; background-color: #ffebeb; border-left: 5px solid #dc3545; padding: 20px; margin-top: 20px; }
        .quote-box { font-style: italic; color: #6c757d; margin-top: 15px; border-left: 3px solid #0d6efd; padding-left: 15px; }
        .badge-category { font-size: 1.2em; padding: 10px 20px; }
        .disclaimer { font-size: 0.8rem; color: #aaa; text-align: center; margin-top: 30px; }
    </style>
</head>
<body>

<div class="container">
    <div class="card main-card shadow-sm">
        <div class="card-header bg-white text-center py-4">
            <h2 class="fw-bold text-primary">Stress Text Analyzer</h2>
            <p class="text-muted mb-0">Enter your thoughts below to analyze stress levels securely.</p>
        </div>
        <div class="card-body p-4">
            
            <div class="mb-3">
                <textarea class="form-control" id="userText" rows="6" placeholder="How are you feeling today? (e.g., 'I feel overwhelmed with work deadlines...')"></textarea>
            </div>
            
            <button class="btn btn-primary w-100 py-2" onclick="analyzeText()" id="analyzeBtn">Analyze Text</button>

            <div id="loader" class="text-center mt-3 d-none">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>

            <div id="resultPanel" class="result-box">
                <hr>
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0">Result: <span id="categoryLabel" class="badge bg-secondary badge-category">NORMAL</span></h4>
                    <span class="text-muted small">Score: <span id="scoreValue">0</span></span>
                </div>

                <label class="form-label text-muted small">Stress Meter</label>
                <div class="progress" style="height: 25px;">
                    <div id="stressBar" class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
                </div>

                <div class="mt-3">
                    <small class="text-muted">Keywords detected:</small>
                    <div id="keywordsList" class="d-flex flex-wrap gap-2 mt-1"></div>
                </div>

                <div class="quote-box bg-light p-3 rounded mt-3">
                    <span id="quoteText">"Keep your face always toward the sunshine—and shadows will fall behind you."</span>
                </div>
            </div>

            <div id="crisisPanel" class="crisis-panel rounded">
                <h4 class="text-danger fw-bold">⚠ You are not alone.</h4>
                <p class="mb-2">It sounds like you are going through a very difficult time. Please reach out for support.</p>
                <ul class="mb-0">
                    <li><strong>India Suicide Prevention:</strong> 91529 87821</li>
                    <li><strong>US National Hotline:</strong> 988</li>
                    <li><strong>Emergency:</strong> 112 (India) / 911 (US)</li>
                </ul>
                <div class="mt-3">
                    <a href="https://findahelpline.com/" target="_blank" class="btn btn-outline-danger btn-sm">Find Global Helplines</a>
                </div>
            </div>

        </div>
    </div>

    <div class="disclaimer">
        <p>⚠ DISCLAIMER: This tool is for awareness only. It is <strong>not</strong> a medical or mental health diagnosis.<br>
        Your text is processed in real-time and not stored permanently.</p>
    </div>
</div>

<script>
    // Configuration - CHANGE THIS URL AFTER DEPLOYING BACKEND
    // For local testing: http://127.0.0.1:8000/analyze
    // For production: https://your-render-app-name.onrender.com/analyze
    const API_URL = "http://127.0.0.1:8000/analyze"; 

    const quotes = {
        POSITIVE: "Keep shining! Your positivity is a strength.",
        NORMAL: "Breathe in, breathe out. Stay grounded in the present moment.",
        STRESSED: "You don't have to see the whole staircase, just take the first step. Take a break.",
        HIGH_STRESS: "It's okay to not be okay. Please be kind to yourself and step away for a moment.",
        CRITICAL: "Your life matters. Please reach out to someone who can help."
    };

    async function analyzeText() {
        const text = document.getElementById('userText').value;
        const btn = document.getElementById('analyzeBtn');
        const loader = document.getElementById('loader');
        const resultPanel = document.getElementById('resultPanel');
        const crisisPanel = document.getElementById('crisisPanel');

        if (!text.trim()) {
            alert("Please enter some text first.");
            return;
        }

        // UI Reset
        btn.disabled = true;
        loader.classList.remove('d-none');
        resultPanel.style.display = 'none';
        crisisPanel.style.display = 'none';

        try {
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text: text })
            });

            const data = await response.json();
            
            renderResults(data);

        } catch (error) {
            console.error("Error:", error);
            alert("Could not connect to the server. Make sure the backend is running.");
        } finally {
            btn.disabled = false;
            loader.classList.add('d-none');
        }
    }

    function renderResults(data) {
        const resultPanel = document.getElementById('resultPanel');
        const crisisPanel = document.getElementById('crisisPanel');
        const catLabel = document.getElementById('categoryLabel');
        const scoreVal = document.getElementById('scoreValue');
        const bar = document.getElementById('stressBar');
        const kwList = document.getElementById('keywordsList');
        const quoteText = document.getElementById('quoteText');

        resultPanel.style.display = 'block';
        
        // Set Basic Data
        catLabel.innerText = data.category;
        scoreVal.innerText = data.score;
        quoteText.innerText = quotes[data.category] || quotes['NORMAL'];

        // Keywords
        kwList.innerHTML = "";
        if(data.detected_keywords.length > 0) {
            data.detected_keywords.forEach(word => {
                kwList.innerHTML += `<span class="badge bg-light text-dark border">${word}</span>`;
            });
        } else {
            kwList.innerHTML = `<span class="text-muted small">No specific keywords detected.</span>`;
        }

        // Style Updates based on Category
        catLabel.className = 'badge badge-category ';
        bar.className = 'progress-bar ';
        let width = '0%';

        switch(data.category) {
            case 'POSITIVE':
                catLabel.classList.add('bg-success');
                bar.classList.add('bg-success');
                width = '20%';
                break;
            case 'NORMAL':
                catLabel.classList.add('bg-info');
                bar.classList.add('bg-info');
                width = '40%';
                break;
            case 'STRESSED':
                catLabel.classList.add('bg-warning', 'text-dark');
                bar.classList.add('bg-warning');
                width = '70%';
                break;
            case 'HIGH_STRESS':
                catLabel.classList.add('bg-danger');
                bar.classList.add('bg-danger');
                width = '90%';
                break;
            case 'CRITICAL':
                catLabel.classList.add('bg-dark');
                bar.classList.add('bg-danger', 'progress-bar-striped', 'progress-bar-animated');
                width = '100%';
                crisisPanel.style.display = 'block'; // SHOW CRISIS PANEL
                break;
        }

        bar.style.width = width;
    }
</script>

</body>
</html>